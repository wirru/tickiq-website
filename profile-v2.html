<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO: Do not index (focus on social sharing, not search discovery) -->
    <meta name="robots" content="noindex,nofollow">

    <!-- Dynamic Meta Tags (replaced by Edge Function) -->
    <title>@{{USERNAME}}'s Watch Collection - tickIQ</title>
    <meta name="description" content="Explore @{{USERNAME}}'s watch collection with real accuracy data from tickIQ. See timing measurements and discover their watches.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="@{{USERNAME}}'s Watch Collection on tickIQ">
    <meta property="og:description" content="Explore this curated collection with real accuracy data. See grail pieces and discover how each watch performs.">
    <meta property="og:image" content="{{OG_IMAGE_URL}}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="https://{{DOMAIN}}/u/{{USERNAME}}">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="@{{USERNAME}}'s Watch Collection on tickIQ">
    <meta name="twitter:description" content="Explore this curated collection with real accuracy data. See timing measurements and watch performance.">
    <meta name="twitter:image" content="{{OG_IMAGE_URL}}">

    <!-- App Links for iOS -->
    <meta property="al:ios:app_name" content="tickIQ">
    <meta property="al:ios:url" content="tickiq://profile/{{USERNAME}}">

    <!-- Favicons -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/favicon-180x180.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Main site styles (includes header/footer) -->
    <link rel="stylesheet" href="/css/styles.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Override body styles from styles.css */
        body {
            display: block !important;
            min-height: auto !important;
            background: #000000 !important;
            color: #FFFFFF !important;
        }

        /* Override main styles from styles.css */
        main {
            flex: none !important;
            padding-top: 0 !important;
            min-height: auto !important;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Profile Header - Hero Section */
        .profile-header {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 12rem 2rem 10rem 2rem;
            text-align: center;
            background: #000000;
            min-height: 100vh;
        }

        .profile-username {
            font-size: 6rem;
            font-weight: 700;
            letter-spacing: -0.04em;
            line-height: 1.1;
            color: #FFFFFF;
            margin-bottom: 0.5rem;
        }

        .profile-username .apostrophe {
            font-weight: 300;
            color: rgba(255, 255, 255, 0.6);
        }

        .profile-tagline {
            font-size: 1.5rem;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.7);
            letter-spacing: 0.01em;
            margin-bottom: 1.5rem;
        }

        .profile-join-date {
            font-size: 0.8rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.15em;
            text-align: center;
            margin-bottom: 3.5rem;
        }

        /* Stats Card */
        .profile-stats-card {
            background: rgba(255, 255, 255, 0.04);
            border-radius: 24px;
            padding: 2.5rem 3rem;
            max-width: 800px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
        }

        /* Stats */
        .profile-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .stat {
            text-align: center;
            flex: 1;
            min-width: 140px;
            padding: 0.5rem 0;
            position: relative;
        }

        .stat:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 70px;
            background: rgba(255, 255, 255, 0.08);
        }

        .stat-value {
            display: block;
            font-size: 2.5rem;
            font-weight: 500;
            color: #FFFFFF;
            line-height: 1;
            margin-bottom: 0.625rem;
        }

        .stat-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.5);
            text-transform: capitalize;
            letter-spacing: 0;
            white-space: nowrap;
        }

        /* Watch Grid Container */
        .watch-grid-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
        }

        /* Watch Grid */
        .watch-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
        }

        .watch-card {
            background: rgba(255, 255, 255, 0.02); /* Card background from iOS */
            border: 1px solid rgba(255, 255, 255, 0.06); /* Border from iOS */
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }

        .watch-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 255, 255, 0.12);
        }

        .watch-image-container {
            aspect-ratio: 1;
            background: #f5f5f5;
            position: relative;
            overflow: hidden;
        }

        .watch-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .watch-image-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f5f5f5 0%, #e5e5e5 100%);
            font-size: 3rem;
        }

        .watch-info {
            padding: 1.25rem;
        }

        .watch-name {
            font-size: 1.125rem;
            font-weight: 600;
            color: #FFFFFF;
            margin-bottom: 0.25rem;
            line-height: 1.3;
        }

        .watch-reference {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.5); /* Tertiary text from iOS */
            margin-bottom: 1rem;
        }

        .watch-measurement {
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.06); /* Border from iOS */
        }

        .measurement-rate {
            font-size: 1.25rem;
            font-weight: 600;
            color: #FFFFFF; /* Primary text from iOS */
            margin-bottom: 0.25rem;
        }

        .measurement-rate.positive {
            color: #ff6b6b;
        }

        .measurement-rate.negative {
            color: #4dabf7;
        }

        .measurement-count {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5); /* Tertiary text from iOS */
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Wearing Stats */
        .wearing-stats {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.7); /* Secondary text from iOS */
        }

        .days-worn {
            font-weight: 600;
            color: #FFFFFF; /* Primary text from iOS */
        }

        .percentage {
            color: rgba(255, 255, 255, 0.5); /* Tertiary text from iOS */
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 6rem 2rem;
        }

        .empty-state h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #FFFFFF;
        }

        .empty-state p {
            font-size: 1.125rem;
            color: rgba(255, 255, 255, 0.7); /* Secondary text from iOS */
        }

        /* CTA Section */
        .cta-section {
            background: rgba(255, 255, 255, 0.02); /* Card background from iOS */
            color: #fff;
            padding: 6rem 2rem;
            text-align: center;
            margin-top: 4rem;
            border-top: 1px solid rgba(255, 255, 255, 0.06); /* Border from iOS */
        }

        .cta-section h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
            color: #FFFFFF; /* Primary text from iOS */
        }

        .cta-section p {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.7); /* Secondary text from iOS */
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .cta-button {
            display: inline-block;
            background: #fff;
            color: #000;
            padding: 1rem 2.5rem;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            border-radius: 980px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 255, 255, 0.3);
        }

        /* Loading State */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            background: #000000;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid rgba(255, 255, 255, 0.06);
            border-top-color: #FFFFFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 1.5rem;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7); /* Secondary text from iOS */
        }

        /* Error State */
        .error-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            text-align: center;
            background: #000000;
        }

        .error-state h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #FFFFFF; /* Primary text from iOS */
        }

        .error-state p {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.7); /* Secondary text from iOS */
            margin-bottom: 2rem;
        }

        .error-button {
            display: inline-block;
            background: #FFFFFF;
            color: #000;
            padding: 1rem 2rem;
            text-decoration: none;
            border-radius: 980px;
            font-weight: 600;
        }

        /* Utilities */
        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .profile-header {
                padding: 10rem 1.5rem 8rem 1.5rem;
                min-height: 100vh;
            }

            .profile-username {
                font-size: 3.5rem;
                letter-spacing: -0.03em;
                margin-bottom: 0.5rem;
            }

            .profile-tagline {
                font-size: 1.125rem;
                margin-bottom: 1rem;
            }

            .profile-join-date {
                font-size: 0.7rem;
                margin-bottom: 2.5rem;
            }

            .profile-stats-card {
                padding: 2rem 1.25rem;
                max-width: 100%;
                margin: 0 1rem;
            }

            .stat-value {
                font-size: 2rem;
            }

            .stat-label {
                font-size: 0.7rem;
            }

            .stat:not(:last-child)::after {
                height: 60px;
            }

            .stat {
                min-width: 90px;
            }

            .stat-value {
                font-size: 2rem;
            }

            .stat-label {
                font-size: 0.7rem;
            }

            .watch-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1.5rem;
            }

            .cta-section h2 {
                font-size: 2rem;
            }

            .watch-grid-container {
                padding: 1rem 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .watch-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .profile-stats {
                gap: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header will be injected by components.js -->
    <header></header>

    <!-- Loading State -->
    <div id="loading" class="loading-state">
        <div class="spinner"></div>
        <p class="loading-text">Loading collection...</p>
    </div>

    <!-- Error State -->
    <div id="error" class="error-state hidden">
        <h1>Profile Not Found</h1>
        <p>This profile is private or doesn't exist.</p>
        <a href="https://tickiq.app" class="error-button">Go to tickIQ</a>
    </div>

    <!-- Profile Content -->
    <div id="profile" class="hidden">
        <!-- Profile Header -->
        <section class="profile-header">
            <h1 class="profile-username" id="username"><span class="apostrophe">'s</span></h1>
            <p class="profile-tagline">State of the Collection</p>
            <p class="profile-join-date" id="join-date">Tracking since ...</p>

            <!-- Stats Card -->
            <div class="profile-stats-card">
                <div class="profile-stats">
                    <div class="stat">
                        <span class="stat-value" id="watch-count">0</span>
                        <span class="stat-label">Watches</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="measurement-count">0</span>
                        <span class="stat-label">Measurements</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="days-logged">0</span>
                        <span class="stat-label">Days Logged</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Watch Grid -->
        <main class="watch-grid-container">
            <div id="watch-grid" class="watch-grid">
                <!-- Watches will be inserted here by JavaScript -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="empty-state hidden">
                <h2>No Watches Yet</h2>
                <p>This collection is just getting started.</p>
            </div>
        </main>

        <!-- CTA Section -->
        <section class="cta-section">
            <h2>Create Your Own Collection</h2>
            <p>Track your watches with professional accuracy. See real performance data and build your collection.</p>
            <a href="https://apps.apple.com/app/tickiq/id6504108092" class="cta-button">Download tickIQ for iOS</a>
        </section>

    </div>

    <!-- Footer will be injected by components.js -->
    <footer></footer>

    <!-- Load shared components -->
    <script src="/js/components.js"></script>

    <script>
        // Client-side rendering (will be hydrated with server-side data)
        (function() {
            // Check if data was injected server-side
            const profileData = window.__PROFILE_DATA__;

            if (profileData) {
                // Server-side data available, render immediately
                renderProfile(profileData);
            } else {
                // Fallback: fetch data client-side (for development/testing)
                console.log('No server-side data, fetching client-side...');
                // In production, this shouldn't happen as we use SSR
                showError();
            }

            function renderProfile(data) {
                try {
                    // Hide loading, show profile
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('profile').classList.remove('hidden');

                    // Set username with @ and possessive
                    const usernameEl = document.getElementById('username');
                    usernameEl.innerHTML = `@${escapeHtml(data.profile.username)}<span class="apostrophe">'s</span>`;

                    // Format and set join date
                    const joinDate = new Date(data.profile.created_at);
                    const monthYear = joinDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                    document.getElementById('join-date').textContent = 'Tracking since ' + monthYear;

                    // Set stats
                    document.getElementById('watch-count').textContent = data.stats.watch_count;
                    document.getElementById('measurement-count').textContent = data.stats.measurement_count;
                    document.getElementById('days-logged').textContent = data.stats.total_posting_days || 0;

                    // Render watches
                    if (data.watches && data.watches.length > 0) {
                        const watchGrid = document.getElementById('watch-grid');
                        watchGrid.innerHTML = data.watches.map(watch => renderWatchCard(watch)).join('');
                    } else {
                        // Show empty state
                        document.getElementById('watch-grid').classList.add('hidden');
                        document.getElementById('empty-state').classList.remove('hidden');
                    }

                } catch (error) {
                    console.error('Error rendering profile:', error);
                    showError();
                }
            }

            function renderWatchCard(watch) {
                const watchName = [watch.make, watch.model].filter(Boolean).join(' ') || 'Watch';
                const referenceText = watch.reference_number ? 'Ref: ' + escapeHtml(watch.reference_number) : '';

                // Image or placeholder
                const imageHtml = watch.thumbnail_url
                    ? `<img src="/api/img/${escapeHtml(watch.thumbnail_url)}" alt="${escapeHtml(watchName)}" class="watch-image" loading="lazy">`
                    : `<div class="watch-image-placeholder">âŒš</div>`;

                // Wearing stats (days worn)
                let wearingHtml = '';
                if (watch.days_worn > 0) {
                    const daysText = watch.days_worn === 1 ? 'day' : 'days';
                    wearingHtml = `
                        <div class="wearing-stats">
                            <span class="days-worn">Worn ${watch.days_worn} ${daysText}</span>
                            <span class="percentage">${watch.percentage_of_rotation.toFixed(1)}%</span>
                        </div>
                    `;
                }

                // Measurement info
                let measurementHtml = '';
                if (watch.latest_measurement) {
                    const rate = watch.latest_measurement.rate;
                    const sign = rate >= 0 ? '+' : '';
                    const rateClass = rate >= 0 ? 'positive' : 'negative';
                    const measurementText = watch.measurement_count === 1
                        ? '1 measurement'
                        : watch.measurement_count + ' measurements';

                    measurementHtml = `
                        <div class="watch-measurement">
                            <div class="measurement-rate ${rateClass}">${sign}${rate.toFixed(1)} s/d</div>
                            <div class="measurement-count">${measurementText}</div>
                        </div>
                    `;
                } else if (watch.measurement_count > 0) {
                    const measurementText = watch.measurement_count === 1
                        ? '1 measurement'
                        : watch.measurement_count + ' measurements';
                    measurementHtml = `
                        <div class="watch-measurement">
                            <div class="measurement-count">${measurementText}</div>
                        </div>
                    `;
                }

                return `
                    <div class="watch-card">
                        <div class="watch-image-container">
                            ${imageHtml}
                        </div>
                        <div class="watch-info">
                            <div class="watch-name">${escapeHtml(watchName)}</div>
                            ${referenceText ? `<div class="watch-reference">${referenceText}</div>` : ''}
                            ${wearingHtml}
                            ${measurementHtml}
                        </div>
                    </div>
                `;
            }

            function showError() {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('profile').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
            }

            function escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        })();
    </script>
</body>
</html>
